{"version":3,"sources":["webpack://webgazer/webpack/bootstrap","webpack://webgazer/./src/params.mjs","webpack://webgazer/./src/dom_util.mjs","webpack://webgazer/./src/facemesh.mjs","webpack://webgazer/./src/mat.mjs","webpack://webgazer/./src/util.mjs","webpack://webgazer/./src/util_regression.mjs","webpack://webgazer/./src/ridgeReg.mjs","webpack://webgazer/./src/ridgeWeightedReg.mjs","webpack://webgazer/./src/ridgeRegThreaded.mjs","webpack://webgazer/./src/index.mjs"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","moveTickSize","videoContainerId","videoElementId","videoElementCanvasId","faceOverlayId","faceFeedbackBoxId","gazeDotId","videoViewerWidth","videoViewerHeight","faceFeedbackBoxRatio","showVideo","mirrorVideo","showFaceOverlay","showFaceFeedbackBox","showGazeDot","camConstraints","video","width","min","ideal","max","height","facingMode","dataTimestep","showVideoPreview","applyKalmanFilter","saveDataAcrossSessions","storingPoints","requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","element","setTimeout","cancelRequestAnimFrame","cancelCancelRequestAnimationFrame","webkitCancelRequestAnimationFrame","mozCancelRequestAnimationFrame","oCancelRequestAnimationFrame","msCancelRequestAnimationFrame","clearTimeout","TFFaceMesh","this","model","load","predictionReady","positionsArray","getEyePatches","async","imageCanvas","predictions","estimateFaces","scaledMesh","positions","leftOriginX","Math","round","leftOriginY","leftWidth","leftHeight","rightOriginX","rightOriginY","rightWidth","rightHeight","console","log","eyeObjs","leftImageData","getContext","getImageData","left","patch","imagex","imagey","rightImageData","right","getPositions","reset","drawFaceOverlay","ctx","keypoints","fillStyle","strokeStyle","lineWidth","x","y","beginPath","arc","PI","closePath","fill","mat","matrix","transposedMatrix","Array","j0","j1","X","i0","i1","size","subI","matrix1","matrix2","Bcolj","k","Arowi","A","B","LU","piv","pivsign","LUrowi","LUcolj","kmax","abs","nx","self","webgazer","getMatrix","QR","nrm","Rdiag","hypot","getSubMatrix","util","Eye","getEyeFeats","eyes","resizedLeft","resizeEye","resizedRight","leftGray","grayscale","rightGray","histLeft","equalizeHistogram","histRight","concat","DataWindow","windowSize","index","entry","ind","getTrueIndex","addAll","pixels","gray","Uint8ClampedArray","w","src","step","dst","srcLength","hist","norm","prev","h","threshold","correlation","data1","data2","count","eye","resizeWidth","resizeHeight","canvas","document","createElement","putImageData","tempCanvas","drawImage","bound","prediction","documentElement","clientWidth","innerWidth","clientHeight","innerHeight","DebugBox","interval","localThis","para","div","appendChild","body","buttons","stats","setInterval","str","innerText","debugBoxWrite","set","inc","incBy","init","addButton","func","button","addEventListener","show","clearRect","util_regression","ridgeParameter","pow","errorXArray","errorYArray","screenXClicksArray","screenYClicksArray","eyeFeaturesClicks","trailTime","trailDataWindow","screenXTrailArray","screenYTrailArray","eyeFeaturesTrail","trailTimes","dataClicks","dataTrail","Q","mul","R","identity","P_initial","kalman","KalmanFilter","F","H","X_initial","P","update","z","add","sub","inv","mult","transpose","X_p","P_p","S","K","ridge","nc","m_Coefficients","xt","solution","success","ss","bb","LUsolve","QRDecomposition","ex","setData","leftData","rightData","ImageData","addData","screenPos","type","getCurrentFixationIndex","recentX","recentY","currX","currY","sqrt","performance","now","RidgeReg","InitRegression","predict","eyesObj","acceptTime","trailX","trailY","trailFeat","screenXArray","screenYArray","eyeFeatures","coefficientsX","coefficientsY","eyeFeats","predictedX","predictedY","floor","newGaze","getData","RidgeWeightedReg","len","weightedEyeFeats","weightedXArray","weightedYArray","weight","trueIndex","val","undefined","weights","RidgeRegThreaded","worker","Worker","onerror","err","message","onmessage","evt","Y","postMessage","tracker","reg","ridgeRegThreaded","params","videoStream","videoContainerElement","videoElement","videoElementCanvas","faceOverlay","faceFeedbackBox","gazeDot","debugVideoLoc","xPast50","yPast50","clockStart","latestEyeFeatures","latestGazeData","paused","nopCallback","time","eventTypes","moveClock","curTracker","regs","curTrackerMap","regressionMap","settings","defaults","getPrediction","regModelIndex","getPupilFeatures","computeValidationBoxSize","vw","videoWidth","vh","videoHeight","pw","parseInt","style","ph","smaller","scalar","boxSize","smoothingVals","loop","elapsedTime","getTracker","topBound","leftBound","rightBound","bottomBound","eyeLX","eyeLY","eyeRX","eyeRY","xPositions","yPositions","border","checkEyesInValidationBox","pred","colour","getElementById","drawCoordinates","storePoints","display","transform","recordScreenPosition","eventType","clickListener","event","clientX","clientY","storeData","localforage","setItem","setGlobalData","moveListener","addMouseEventListeners","stream","id","position","top","setAttribute","srcObject","autoplay","setProperty","zIndex","background","borderRadius","opacity","setupPreviewVideo","e","setInternalVideoBufferSizes","setVideoViewerSize","target","removeEventListener","begin","onFail","location","protocol","hostname","chrome","alert","getItem","loadData","loadGlobalData","navigator","mediaDevices","getUserMedia","constraints","webkitGetUserMedia","mozGetUserMedia","Promise","resolve","reject","Error","isReady","pause","resume","end","removeChild","stopVideo","getTracks","stop","detectCompatibility","showPredictionPoints","setCameraConstraints","videoTrack","videoSettings","getVideoTracks","applyConstraints","getSettings","setStaticVideo","videoLoc","tlwh","removeMouseEventListeners","setTracker","setRegression","addTrackerModule","constructor","addRegressionModule","addRegression","newReg","setGazeListener","listener","clearGazeListener","setVideoElementCanvas","clearData","clear","getRegression","getCurrentPrediction","regIndex","getEventTypes","getVideoElementCanvas","getVideoPreviewToCameraResolutionRatio","getStoredPoints"],"mappings":"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","file":"webgazer.min.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonpwebgazer\"] = window[\"webpackJsonpwebgazer\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([90,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","const params = {\n  moveTickSize: 50,\n  videoContainerId: 'webgazerVideoContainer',\n  videoElementId: 'webgazerVideoFeed',\n  videoElementCanvasId: 'webgazerVideoCanvas',\n  faceOverlayId: 'webgazerFaceOverlay',\n  faceFeedbackBoxId: 'webgazerFaceFeedbackBox',\n  gazeDotId: 'webgazerGazeDot',\n  videoViewerWidth: 320,\n  videoViewerHeight: 240,\n  faceFeedbackBoxRatio: 0.66,\n  // View options\n  showVideo: true,\n  mirrorVideo: true,\n  showFaceOverlay: true,\n  showFaceFeedbackBox: true,\n  showGazeDot: true,\n  camConstraints: { video: { width: { min: 320, ideal: 640, max: 1920 }, height: { min: 240, ideal: 480, max: 1080 }, facingMode: \"user\" } },\n  dataTimestep: 50,\n  showVideoPreview: true,\n  applyKalmanFilter: true,\n  saveDataAcrossSessions: true,\n  // Whether or not to store accuracy eigenValues, used by the calibration example file\n  storingPoints: false,\n};\n\nexport default params;\n","// helper functions\n\n/**\n * Provides requestAnimationFrame in a cross browser way.\n */\nwindow.requestAnimFrame = (function() {\n  return window.requestAnimationFrame ||\n    window.webkitRequestAnimationFrame ||\n    window.mozRequestAnimationFrame ||\n    window.oRequestAnimationFrame ||\n    window.msRequestAnimationFrame ||\n    function(/* function FrameRequestCallback */ callback, /* DOMElement Element */ element) {\n      return window.setTimeout(callback, 1000/60);\n    };\n})();\n\n/**\n * Provides cancelRequestAnimationFrame in a cross browser way.\n */\nwindow.cancelRequestAnimFrame = (function() {\n  return window.cancelCancelRequestAnimationFrame ||\n    window.webkitCancelRequestAnimationFrame ||\n    window.mozCancelRequestAnimationFrame ||\n    window.oCancelRequestAnimationFrame ||\n    window.msCancelRequestAnimationFrame ||\n    window.clearTimeout;\n})();\n","import FacemeshModel from '@tensorflow-models/facemesh';\n/**\n * Constructor of TFFaceMesh object\n * @constructor\n * */\nconst TFFaceMesh = function() {\n  //Backend options are webgl, wasm, and CPU.\n  //For recent laptops WASM is better than WebGL.\n  //TODO: This hack makes loading the model block the UI. We should fix that\n  // this.model = (async () => { return await facemesh.load({\"maxFaces\":1}) })();\n  this.model = FacemeshModel.load({\"maxFaces\":1});\n  this.predictionReady = false;\n};\n\n// Global variable for face landmark positions array\nTFFaceMesh.prototype.positionsArray = null;\n\n/**\n * Isolates the two patches that correspond to the user's eyes\n * @param  {Canvas} imageCanvas - canvas corresponding to the webcam stream\n * @param  {Number} width - of imageCanvas\n * @param  {Number} height - of imageCanvas\n * @return {Object} the two eye-patches, first left, then right eye\n */\nTFFaceMesh.prototype.getEyePatches = async function(imageCanvas, width, height) {\n\n  if (imageCanvas.width === 0) {\n    return null;\n  }\n\n  // Load the MediaPipe facemesh model.\n  const model = await this.model;\n\n  // Pass in a video stream (or an image, canvas, or 3D tensor) to obtain an\n  // array of detected faces from the MediaPipe graph.\n  const predictions = await model.estimateFaces(imageCanvas);\n\n  if (predictions.length == 0){\n    return false;\n  }\n\n  // Save positions to global variable\n  this.positionsArray = predictions[0].scaledMesh;\n  const positions = this.positionsArray;\n\n  // Fit the detected eye in a rectangle. [20200626 xk] not clear which approach is better\n  // https://raw.githubusercontent.com/tensorflow/tfjs-models/master/facemesh/mesh_map.jpg\n\n  // // Maintains a relatively stable shape of the bounding box at the cost of cutting off parts of\n  // // the eye when the eye is tilted.\n  // var leftOriginX = Math.round(positions[130][0]);\n  // var leftOriginY = Math.round(positions[27][1]);\n  // var leftWidth = Math.round(positions[243][0] - leftOriginX);\n  // var leftHeight = Math.round(positions[23][1] - leftOriginY);\n  // var rightOriginX = Math.round(positions[463][0]);\n  // var rightOriginY = Math.round(positions[257][1]);\n  // var rightWidth = Math.round(positions[359][0] - rightOriginX);\n  // var rightHeight = Math.round(positions[253][1] - rightOriginY);\n\n  // Won't really cut off any parts of the eye, at the cost of warping the shape (i.e. height/\n  // width ratio) of the bounding box.\n  var leftOriginX = Math.round(Math.min(positions[247][0], positions[130][0], positions[25][0]));\n  var leftOriginY = Math.round(Math.min(positions[247][1], positions[27][1], positions[190][1]));\n  var leftWidth = Math.round(Math.max(positions[190][0], positions[243][0], positions[233][0]) - leftOriginX);\n  var leftHeight = Math.round(Math.max(positions[25][1], positions[23][1], positions[112][1]) - leftOriginY);\n  var rightOriginX = Math.round(Math.min(positions[414][0], positions[463][0], positions[453][0]));\n  var rightOriginY = Math.round(Math.min(positions[414][1], positions[257][1], positions[467][1]));\n  var rightWidth = Math.round(Math.max(positions[467][0], positions[359][0], positions[255][0]) - rightOriginX);\n  var rightHeight = Math.round(Math.max(positions[341][1], positions[253][1], positions[255][1]) - rightOriginY);\n\n  if (leftWidth === 0 || rightWidth === 0){\n    console.log('an eye patch had zero width');\n    return null;\n  }\n\n  if (leftHeight === 0 || rightHeight === 0){\n    console.log('an eye patch had zero height');\n    return null;\n  }\n\n  // Start building object to be returned\n  var eyeObjs = {};\n\n  var leftImageData = imageCanvas.getContext('2d').getImageData(leftOriginX, leftOriginY, leftWidth, leftHeight);\n  eyeObjs.left = {\n    patch: leftImageData,\n    imagex: leftOriginX,\n    imagey: leftOriginY,\n    width: leftWidth,\n    height: leftHeight\n  };\n\n  var rightImageData = imageCanvas.getContext('2d').getImageData(rightOriginX, rightOriginY, rightWidth, rightHeight);\n  eyeObjs.right = {\n    patch: rightImageData,\n    imagex: rightOriginX,\n    imagey: rightOriginY,\n    width: rightWidth,\n    height: rightHeight\n  };\n\n  this.predictionReady = true;\n\n  return eyeObjs;\n};\n\n/**\n * Returns the positions array corresponding to the last call to getEyePatches.\n * Requires that getEyePatches() was called previously, else returns null.\n */\nTFFaceMesh.prototype.getPositions = function () {\n  return this.positionsArray;\n}\n\n/**\n * Reset the tracker to default values\n */\nTFFaceMesh.prototype.reset = function(){\n  console.log( \"Unimplemented; Tracking.js has no obvious reset function\" );\n}\n\n/**\n * Draw TF_FaceMesh_Overlay\n */\nTFFaceMesh.prototype.drawFaceOverlay= function(ctx, keypoints){\n  // If keypoints is falsy, don't do anything\n  if (keypoints) {\n    ctx.fillStyle = '#32EEDB';\n    ctx.strokeStyle = '#32EEDB';\n    ctx.lineWidth = 0.5;\n\n    for (let i = 0; i < keypoints.length; i++) {\n      const x = keypoints[i][0];\n      const y = keypoints[i][1];\n\n      ctx.beginPath();\n      ctx.arc(x, y, 1 /* radius */, 0, 2 * Math.PI);\n      ctx.closePath();\n      ctx.fill();\n    }\n  }\n}\n\n/**\n * The TFFaceMesh object name\n * @type {string}\n */\nTFFaceMesh.prototype.name = 'TFFaceMesh';\n\nexport default TFFaceMesh;\n","const mat = {};\n/**\n * Transposes an mxn array\n * @param {Array.<Array.<Number>>} matrix - of 'M x N' dimensionality\n * @return {Array.<Array.<Number>>} transposed matrix\n */\nmat.transpose = function(matrix){\n    var m = matrix.length;\n    var n = matrix[0].length;\n    var transposedMatrix = new Array(n);\n\n    for (var i = 0; i < m; i++){\n        for (var j = 0; j < n; j++){\n            if (i === 0) transposedMatrix[j] = new Array(m);\n            transposedMatrix[j][i] = matrix[i][j];\n        }\n    }\n\n    return transposedMatrix;\n};\n\n/**\n * Get a sub-matrix of matrix\n * @param {Array.<Array.<Number>>} matrix - original matrix\n * @param {Array.<Number>} r - Array of row indices\n * @param {Number} j0 - Initial column index\n * @param {Number} j1 - Final column index\n * @returns {Array} The sub-matrix matrix(r(:),j0:j1)\n */\nmat.getMatrix = function(matrix, r, j0, j1){\n    var X = new Array(r.length),\n        m = j1-j0+1;\n\n    for (var i = 0; i < r.length; i++){\n        X[i] = new Array(m);\n        for (var j = j0; j <= j1; j++){\n            X[i][j-j0] = matrix[r[i]][j];\n        }\n    }\n    return X;\n};\n\n/**\n * Get a submatrix of matrix\n * @param {Array.<Array.<Number>>} matrix - original matrix\n * @param {Number} i0 - Initial row index\n * @param {Number} i1 - Final row index\n * @param {Number} j0 - Initial column index\n * @param {Number} j1 - Final column index\n * @return {Array} The sub-matrix matrix(i0:i1,j0:j1)\n */\nmat.getSubMatrix = function(matrix, i0, i1, j0, j1){\n    var size = j1 - j0 + 1,\n        X = new Array(i1-i0+1);\n\n    for (var i = i0; i <= i1; i++){\n        var subI = i-i0;\n\n        X[subI] = new Array(size);\n\n        for (var j = j0; j <= j1; j++){\n            X[subI][j-j0] = matrix[i][j];\n        }\n    }\n    return X;\n};\n\n/**\n * Linear algebraic matrix multiplication, matrix1 * matrix2\n * @param {Array.<Array.<Number>>} matrix1\n * @param {Array.<Array.<Number>>} matrix2\n * @return {Array.<Array.<Number>>} Matrix product, matrix1 * matrix2\n */\nmat.mult = function(matrix1, matrix2){\n\n    if (matrix2.length != matrix1[0].length){\n        console.log('Matrix inner dimensions must agree:');\n\n    }\n\n    var X = new Array(matrix1.length),\n        Bcolj = new Array(matrix1[0].length);\n\n    for (var j = 0; j < matrix2[0].length; j++){\n        for (var k = 0; k < matrix1[0].length; k++){\n            Bcolj[k] = matrix2[k][j];\n        }\n        for (var i = 0; i < matrix1.length; i++){\n\n            if (j === 0)\n                X[i] = new Array(matrix2[0].length);\n\n            var Arowi = matrix1[i];\n            var s = 0;\n            for (var k = 0; k < matrix1[0].length; k++){\n                s += Arowi[k]*Bcolj[k];\n            }\n            X[i][j] = s;\n        }\n    }\n    return X;\n};\n\n\n/**\n * LUDecomposition to solve A*X = B, based on WEKA code\n * @param {Array.<Array.<Number>>} A - left matrix of equation to be solved\n * @param {Array.<Array.<Number>>} B - right matrix of equation to be solved\n * @return {Array.<Array.<Number>>} X so that L*U*X = B(piv,:)\n */\nmat.LUDecomposition = function(A,B){\n    var LU = new Array(A.length);\n\n    for (var i = 0; i < A.length; i++){\n        LU[i] = new Array(A[0].length);\n        for (var j = 0; j < A[0].length; j++){\n            LU[i][j] = A[i][j];\n        }\n    }\n\n    var m = A.length;\n    var n = A[0].length;\n    var piv = new Array(m);\n    for (var i = 0; i < m; i++){\n        piv[i] = i;\n    }\n    var pivsign = 1;\n    var LUrowi = new Array();\n    var LUcolj = new Array(m);\n    // Outer loop.\n    for (var j = 0; j < n; j++){\n        // Make a copy of the j-th column to localize references.\n        for (var i = 0; i < m; i++){\n            LUcolj[i] = LU[i][j];\n        }\n        // Apply previous transformations.\n        for (var i = 0; i < m; i++){\n            LUrowi = LU[i];\n            // Most of the time is spent in the following dot product.\n            var kmax = Math.min(i,j);\n            var s = 0;\n            for (var k = 0; k < kmax; k++){\n                s += LUrowi[k]*LUcolj[k];\n            }\n            LUrowi[j] = LUcolj[i] -= s;\n        }\n        // Find pivot and exchange if necessary.\n        var p = j;\n        for (var i = j+1; i < m; i++){\n            if (Math.abs(LUcolj[i]) > Math.abs(LUcolj[p])){\n                p = i;\n            }\n        }\n        if (p != j){\n            for (var k = 0; k < n; k++){\n                var t = LU[p][k];\n                LU[p][k] = LU[j][k];\n                LU[j][k] = t;\n            }\n            var k = piv[p];\n            piv[p] = piv[j];\n            piv[j] = k;\n            pivsign = -pivsign;\n        }\n        // Compute multipliers.\n        if (j < m & LU[j][j] != 0){\n            for (var i = j+1; i < m; i++){\n                LU[i][j] /= LU[j][j];\n            }\n        }\n    }\n    if (B.length != m){\n        console.log('Matrix row dimensions must agree.');\n    }\n    for (var j = 0; j < n; j++){\n        if (LU[j][j] === 0){\n            console.log('Matrix is singular.')\n        }\n    }\n    var nx = B[0].length;\n    var X = self.webgazer.mat.getMatrix(B,piv,0,nx-1);\n    // Solve L*Y = B(piv,:)\n    for (var k = 0; k < n; k++){\n        for (var i = k+1; i < n; i++){\n            for (var j = 0; j < nx; j++){\n                X[i][j] -= X[k][j]*LU[i][k];\n            }\n        }\n    }\n    // Solve U*X = Y;\n    for (var k = n-1; k >= 0; k--){\n        for (var j = 0; j < nx; j++){\n            X[k][j] /= LU[k][k];\n        }\n        for (var i = 0; i < k; i++){\n            for (var j = 0; j < nx; j++){\n                X[i][j] -= X[k][j]*LU[i][k];\n            }\n        }\n    }\n    return X;\n};\n\n/**\n * Least squares solution of A*X = B, based on WEKA code\n * @param {Array.<Array.<Number>>} A - left side matrix to be solved\n * @param {Array.<Array.<Number>>} B - a matrix with as many rows as A and any number of columns.\n * @return {Array.<Array.<Number>>} X - that minimizes the two norms of QR*X-B.\n */\nmat.QRDecomposition = function(A, B){\n    // Initialize.\n    var QR = new Array(A.length);\n\n    for (var i = 0; i < A.length; i++){\n        QR[i] = new Array(A[0].length);\n        for (var j = 0; j < A[0].length; j++){\n            QR[i][j] = A[i][j];\n        }\n    }\n    var m = A.length;\n    var n = A[0].length;\n    var Rdiag = new Array(n);\n    var nrm;\n\n    // Main loop.\n    for (var k = 0; k < n; k++){\n        // Compute 2-norm of k-th column without under/overflow.\n        nrm = 0;\n        for (var i = k; i < m; i++){\n            nrm = Math.hypot(nrm,QR[i][k]);\n        }\n        if (nrm != 0){\n            // Form k-th Householder vector.\n            if (QR[k][k] < 0){\n                nrm = -nrm;\n            }\n            for (var i = k; i < m; i++){\n                QR[i][k] /= nrm;\n            }\n            QR[k][k] += 1;\n\n            // Apply transformation to remaining columns.\n            for (var j = k+1; j < n; j++){\n                var s = 0;\n                for (var i = k; i < m; i++){\n                    s += QR[i][k]*QR[i][j];\n                }\n                s = -s/QR[k][k];\n                for (var i = k; i < m; i++){\n                    QR[i][j] += s*QR[i][k];\n                }\n            }\n        }\n        Rdiag[k] = -nrm;\n    }\n    if (B.length != m){\n        console.log('Matrix row dimensions must agree.');\n    }\n    for (var j = 0; j < n; j++){\n        if (Rdiag[j] === 0)\n            console.log('Matrix is rank deficient');\n    }\n    // Copy right hand side\n    var nx = B[0].length;\n    var X = new Array(B.length);\n    for(var i=0; i<B.length; i++){\n        X[i] = new Array(B[0].length);\n    }\n    for (var i = 0; i < B.length; i++){\n        for (var j = 0; j < B[0].length; j++){\n            X[i][j] = B[i][j];\n        }\n    }\n    // Compute Y = transpose(Q)*B\n    for (var k = 0; k < n; k++){\n        for (var j = 0; j < nx; j++){\n            var s = 0.0;\n            for (var i = k; i < m; i++){\n                s += QR[i][k]*X[i][j];\n            }\n            s = -s/QR[k][k];\n            for (var i = k; i < m; i++){\n                X[i][j] += s*QR[i][k];\n            }\n        }\n    }\n    // Solve R*X = Y;\n    for (var k = n-1; k >= 0; k--){\n        for (var j = 0; j < nx; j++){\n            X[k][j] /= Rdiag[k];\n        }\n        for (var i = 0; i < k; i++){\n            for (var j = 0; j < nx; j++){\n                X[i][j] -= X[k][j]*QR[i][k];\n            }\n        }\n    }\n    return mat.getSubMatrix(X,0,n-1,0,nx-1);\n}\n\nexport default mat;\n","import mat from './mat';\nimport params from './params';\nimport numeric from 'numeric';\n\nconst util = {};\n\n\nvar resizeWidth = 10;\nvar resizeHeight = 6;\n\n//not used !?\n/**\n * Eye class, represents an eye patch detected in the video stream\n * @param {ImageData} patch - the image data corresponding to an eye\n * @param {Number} imagex - x-axis offset from the top-left corner of the video canvas\n * @param {Number} imagey - y-axis offset from the top-left corner of the video canvas\n * @param {Number} width  - width of the eye patch\n * @param {Number} height - height of the eye patch\n */\nutil.Eye = function(patch, imagex, imagey, width, height) {\n    this.patch = patch;\n    this.imagex = imagex;\n    this.imagey = imagey;\n    this.width = width;\n    this.height = height;\n};\n\n/**\n * Compute eyes size as gray histogram\n * @param {Object} eyes - The eyes where looking for gray histogram\n * @returns {Array.<T>} The eyes gray level histogram\n */\nutil.getEyeFeats = function(eyes) {\n    var resizedLeft = this.resizeEye(eyes.left, resizeWidth, resizeHeight);\n    var resizedRight = this.resizeEye(eyes.right, resizeWidth, resizeHeight);\n    \n    var leftGray = this.grayscale(resizedLeft.data, resizedLeft.width, resizedLeft.height);\n    var rightGray = this.grayscale(resizedRight.data, resizedRight.width, resizedRight.height);\n\n    var histLeft = [];\n    this.equalizeHistogram(leftGray, 5, histLeft);\n    var histRight = [];\n    this.equalizeHistogram(rightGray, 5, histRight);\n\n    var leftGrayArray = Array.prototype.slice.call(histLeft);\n    var rightGrayArray = Array.prototype.slice.call(histRight);\n\n    return histLeft.concat(histRight);\n}\n//Data Window class\n//operates like an array but 'wraps' data around to keep the array at a fixed windowSize\n/**\n * DataWindow class - Operates like an array, but 'wraps' data around to keep the array at a fixed windowSize\n * @param {Number} windowSize - defines the maximum size of the window\n * @param {Array} data - optional data to seed the DataWindow with\n **/\nutil.DataWindow = function(windowSize, data) {\n    this.data = [];\n    this.windowSize = windowSize;\n    this.index = 0;\n    this.length = 0;\n    if(data){\n        this.data = data.slice(data.length-windowSize,data.length);\n        this.length = this.data.length;\n    }\n};\n\n/**\n * [push description]\n * @param  {*} entry - item to be inserted. It either grows the DataWindow or replaces the oldest item\n * @return {DataWindow} this\n */\nutil.DataWindow.prototype.push = function(entry) {\n    if (this.data.length < this.windowSize) {\n        this.data.push(entry);\n        this.length = this.data.length;\n        return this;\n    }\n\n    //replace oldest entry by wrapping around the DataWindow\n    this.data[this.index] = entry;\n    this.index = (this.index + 1) % this.windowSize;\n    return this;\n};\n\n/**\n * Get the element at the ind position by wrapping around the DataWindow\n * @param  {Number} ind index of desired entry\n * @return {*}\n */\nutil.DataWindow.prototype.get = function(ind) {\n    return this.data[this.getTrueIndex(ind)];\n};\n\n/**\n * Gets the true this.data array index given an index for a desired element\n * @param {Number} ind - index of desired entry\n * @return {Number} index of desired entry in this.data\n */\nutil.DataWindow.prototype.getTrueIndex = function(ind) {\n    if (this.data.length < this.windowSize) {\n        return ind;\n    } else {\n        //wrap around ind so that we can traverse from oldest to newest\n        return (ind + this.index) % this.windowSize;\n    }\n};\n\n/**\n * Append all the contents of data\n * @param {Array} data - to be inserted\n */\nutil.DataWindow.prototype.addAll = function(data) {\n    for (var i = 0; i < data.length; i++) {\n        this.push(data[i]);\n    }\n};\n\n\n//Helper functions\n/**\n * Grayscales an image patch. Can be used for the whole canvas, detected face, detected eye, etc.\n *\n * Code from tracking.js by Eduardo Lundgren, et al.\n * https://github.com/eduardolundgren/tracking.js/blob/master/src/tracking.js\n *\n * Software License Agreement (BSD License) Copyright (c) 2014, Eduardo A. Lundgren Melo. All rights reserved.\n * Redistribution and use of this software in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\n * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\n * The name of Eduardo A. Lundgren Melo may not be used to endorse or promote products derived from this software without specific prior written permission of Eduardo A. Lundgren Melo.\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n * IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)\n * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * @param  {Array} pixels - image data to be grayscaled\n * @param  {Number} width  - width of image data to be grayscaled\n * @param  {Number} height - height of image data to be grayscaled\n * @return {Array} grayscaledImage\n */\nutil.grayscale = function(pixels, width, height){\n    var gray = new Uint8ClampedArray(pixels.length >> 2);\n    var p = 0;\n    var w = 0;\n    for (var i = 0; i < height; i++) {\n        for (var j = 0; j < width; j++) {\n            var value = pixels[w] * 0.299 + pixels[w + 1] * 0.587 + pixels[w + 2] * 0.114;\n            gray[p++] = value;\n\n            w += 4;\n        }\n    }\n    return gray;\n};\n\n/**\n * Increase contrast of an image.\n *\n * Code from Martin Tschirsich, Copyright (c) 2012.\n * https://github.com/mtschirs/js-objectdetect/blob/gh-pages/js/objectdetect.js\n *\n * @param {Array} src - grayscale integer array\n * @param {Number} step - sampling rate, control performance\n * @param {Array} dst - array to hold the resulting image\n */\nutil.equalizeHistogram = function(src, step, dst) {\n    var srcLength = src.length;\n    if (!dst) dst = src;\n    if (!step) step = 5;\n\n    // Compute histogram and histogram sum:\n    var hist = Array(256).fill(0);\n\n    for (var i = 0; i < srcLength; i += step) {\n        ++hist[src[i]];\n    }\n\n    // Compute integral histogram:\n    var norm = 255 * step / srcLength,\n        prev = 0;\n    for (var i = 0; i < 256; ++i) {\n        var h = hist[i];\n        prev = h += prev;\n        hist[i] = h * norm; // For non-integer src: ~~(h * norm + 0.5);\n    }\n\n    // Equalize image:\n    for (var i = 0; i < srcLength; ++i) {\n        dst[i] = hist[src[i]];\n    }\n    return dst;\n};\n\n//not used !?\nutil.threshold = function(data, threshold) {\n    for (let i = 0; i < data.length; i++) {\n        data[i] = (data[i] > threshold) ? 255 : 0;\n    }\n    return data;\n};\n\n//not used !?\nutil.correlation = function(data1, data2) {\n    const length = Math.min(data1.length, data2.length);\n    let count = 0;\n    for (let i = 0; i < length; i++) {\n        if (data1[i] === data2[i]) {\n            count++;\n        }\n    }\n    return count / Math.max(data1.length, data2.length);\n};\n\n/**\n * Gets an Eye object and resizes it to the desired resolution\n * @param  {webgazer.util.Eye} eye - patch to be resized\n * @param  {Number} resizeWidth - desired width\n * @param  {Number} resizeHeight - desired height\n * @return {webgazer.util.Eye} resized eye patch\n */\nutil.resizeEye = function(eye, resizeWidth, resizeHeight) {\n\n    var canvas = document.createElement('canvas');\n    canvas.width = eye.width;\n    canvas.height = eye.height;\n\n    canvas.getContext('2d').putImageData(eye.patch,0,0);\n\n    var tempCanvas = document.createElement('canvas');\n\n    tempCanvas.width = resizeWidth;\n    tempCanvas.height = resizeHeight;\n\n    // save the canvas into temp canvas\n    tempCanvas.getContext('2d').drawImage(canvas, 0, 0, canvas.width, canvas.height, 0, 0, resizeWidth, resizeHeight);\n\n    return tempCanvas.getContext('2d').getImageData(0, 0, resizeWidth, resizeHeight);\n};\n\n/**\n * Checks if the prediction is within the boundaries of the viewport and constrains it\n * @param  {Array} prediction [x,y] - predicted gaze coordinates\n * @return {Array} constrained coordinates\n */\nutil.bound = function(prediction){\n    if(prediction.x < 0)\n        prediction.x = 0;\n    if(prediction.y < 0)\n        prediction.y = 0;\n    var w = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n    var h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\n    if(prediction.x > w){\n        prediction.x = w;\n    }\n\n    if(prediction.y > h)\n    {\n        prediction.y = h;\n    }\n    return prediction;\n};\n\n//not used !?\n/**\n * Write statistics in debug paragraph panel\n * @param {HTMLElement} para - The <p> tag where write data\n * @param {Object} stats - The stats data to output\n */\nfunction debugBoxWrite(para, stats) {\n    var str = '';\n    for (var key in stats) {\n        str += key + ': ' + stats[key] + '\\n';\n    }\n    para.innerText = str;\n}\n\n//not used !?\n/**\n * Constructor of DebugBox object,\n * it insert an paragraph inside a div to the body, in view to display debug data\n * @param {Number} interval - The log interval\n * @constructor\n */\nutil.DebugBox = function(interval) {\n    this.para = document.createElement('p');\n    this.div = document.createElement('div');\n    this.div.appendChild(this.para);\n    document.body.appendChild(this.div);\n\n    this.buttons = {};\n    this.canvas = {};\n    this.stats = {};\n    var updateInterval = interval || 300;\n    (function(localThis) {\n        setInterval(function() {\n            debugBoxWrite(localThis.para, localThis.stats);\n        }, updateInterval);\n    }(this));\n};\n\n//not used !?\n/**\n * Add stat data for log\n * @param {String} key - The data key\n * @param {*} value - The value\n */\nutil.DebugBox.prototype.set = function(key, value) {\n    this.stats[key] = value;\n};\n\n//not used !?\n/**\n * Initialize stats in case where key does not exist, else\n * increment value for key\n * @param {String} key - The key to process\n * @param {Number} incBy - Value to increment for given key (default: 1)\n * @param {Number} init - Initial value in case where key does not exist (default: 0)\n */\nutil.DebugBox.prototype.inc = function(key, incBy, init) {\n    if (!this.stats[key]) {\n        this.stats[key] = init || 0;\n    }\n    this.stats[key] += incBy || 1;\n};\n\n//not used !?\n/**\n * Create a button and register the given function to the button click event\n * @param {String} name - The button name to link\n * @param {Function} func - The onClick callback\n */\nutil.DebugBox.prototype.addButton = function(name, func) {\n    if (!this.buttons[name]) {\n        this.buttons[name] = document.createElement('button');\n        this.div.appendChild(this.buttons[name]);\n    }\n    var button = this.buttons[name];\n    this.buttons[name] = button;\n    button.addEventListener('click', func);\n    button.innerText = name;\n};\n\n//not used !?\n/**\n * Search for a canvas elemenet with name, or create on if not exist.\n * Then send the canvas element as callback parameter.\n * @param {String} name - The canvas name to send/create\n * @param {Function} func - The callback function where send canvas\n */\nutil.DebugBox.prototype.show = function(name, func) {\n    if (!this.canvas[name]) {\n        this.canvas[name] = document.createElement('canvas');\n        this.div.appendChild(this.canvas[name]);\n    }\n    var canvas = this.canvas[name];\n    canvas.getContext('2d').clearRect(0,0, canvas.width, canvas.height);\n    func(canvas);\n};\n\nexport default util;\n","import util from './util';\nimport numeric from 'numeric';\nimport mat from './mat';\nimport params from './params';\n\nconst util_regression = {};\n\n\n/**\n * Initialize new arrays and initialize Kalman filter for regressions.\n */\nutil_regression.InitRegression = function() {\n  var dataWindow = 700;\n  var trailDataWindow = 10;\n  this.ridgeParameter = Math.pow(10,-5);\n  this.errorXArray = new util.DataWindow(dataWindow);\n  this.errorYArray = new util.DataWindow(dataWindow);\n\n\n  this.screenXClicksArray = new util.DataWindow(dataWindow);\n  this.screenYClicksArray = new util.DataWindow(dataWindow);\n  this.eyeFeaturesClicks = new util.DataWindow(dataWindow);\n\n  //sets to one second worth of cursor trail\n  this.trailTime = 1000;\n  this.trailDataWindow = this.trailTime / params.moveTickSize;\n  this.screenXTrailArray = new util.DataWindow(trailDataWindow);\n  this.screenYTrailArray = new util.DataWindow(trailDataWindow);\n  this.eyeFeaturesTrail = new util.DataWindow(trailDataWindow);\n  this.trailTimes = new util.DataWindow(trailDataWindow);\n\n  this.dataClicks = new util.DataWindow(dataWindow);\n  this.dataTrail = new util.DataWindow(trailDataWindow);\n\n  // Initialize Kalman filter [20200608 xk] what do we do about parameters?\n  // [20200611 xk] unsure what to do w.r.t. dimensionality of these matrices. So far at least\n  //               by my own anecdotal observation a 4x1 x vector seems to work alright\n  var F = [ [1, 0, 1, 0],\n    [0, 1, 0, 1],\n    [0, 0, 1, 0],\n    [0, 0, 0, 1]];\n\n  //Parameters Q and R may require some fine tuning\n  var Q = [ [1/4, 0,    1/2, 0],\n    [0,   1/4,  0,   1/2],\n    [1/2, 0,    1,   0],\n    [0,  1/2,  0,   1]];// * delta_t\n  var delta_t = 1/10; // The amount of time between frames\n  Q = numeric.mul(Q, delta_t);\n\n  var H = [ [1, 0, 0, 0, 0, 0],\n    [0, 1, 0, 0, 0, 0],\n    [0, 0, 1, 0, 0, 0],\n    [0, 0, 0, 1, 0, 0]];\n  var H = [ [1, 0, 0, 0],\n    [0, 1, 0, 0]];\n  var pixel_error = 47; //We will need to fine tune this value [20200611 xk] I just put a random value here\n\n  //This matrix represents the expected measurement error\n  var R = numeric.mul(numeric.identity(2), pixel_error);\n\n  var P_initial = numeric.mul(numeric.identity(4), 0.0001); //Initial covariance matrix\n  var x_initial = [[500], [500], [0], [0]]; // Initial measurement matrix\n\n  this.kalman = new util_regression.KalmanFilter(F, H, Q, R, P_initial, x_initial);\n}\n\n/**\n * Kalman Filter constructor\n * Kalman filters work by reducing the amount of noise in a models.\n * https://blog.cordiner.net/2011/05/03/object-tracking-using-a-kalman-filter-matlab/\n *\n * @param {Array.<Array.<Number>>} F - transition matrix\n * @param {Array.<Array.<Number>>} Q - process noise matrix\n * @param {Array.<Array.<Number>>} H - maps between measurement vector and noise matrix\n * @param {Array.<Array.<Number>>} R - defines measurement error of the device\n * @param {Array} P_initial - the initial state\n * @param {Array} X_initial - the initial state of the device\n */\nutil_regression.KalmanFilter = function(F, H, Q, R, P_initial, X_initial) {\n    this.F = F; // State transition matrix\n    this.Q = Q; // Process noise matrix\n    this.H = H; // Transformation matrix\n    this.R = R; // Measurement Noise\n    this.P = P_initial; //Initial covariance matrix\n    this.X = X_initial; //Initial guess of measurement\n};\n\n/**\n * Get Kalman next filtered value and update the internal state\n * @param {Array} z - the new measurement\n * @return {Array}\n */\nutil_regression.KalmanFilter.prototype.update = function(z) {\n    // Here, we define all the different matrix operations we will need\n    var add = numeric.add, sub = numeric.sub, inv = numeric.inv, identity = numeric.identity;\n    var mult = mat.mult, transpose = mat.transpose;\n    //TODO cache variables like the transpose of H\n\n    // prediction: X = F * X  |  P = F * P * F' + Q\n    var X_p = mult(this.F, this.X); //Update state vector\n    var P_p = add(mult(mult(this.F,this.P), transpose(this.F)), this.Q); //Predicted covaraince\n\n    //Calculate the update values\n    var y = sub(z, mult(this.H, X_p)); // This is the measurement error (between what we expect and the actual value)\n    var S = add(mult(mult(this.H, P_p), transpose(this.H)), this.R); //This is the residual covariance (the error in the covariance)\n\n    // kalman multiplier: K = P * H' * (H * P * H' + R)^-1\n    var K = mult(P_p, mult(transpose(this.H), inv(S))); //This is the Optimal Kalman Gain\n\n    //We need to change Y into it's column vector form\n    for(var i = 0; i < y.length; i++){\n        y[i] = [y[i]];\n    }\n\n    //Now we correct the internal values of the model\n    // correction: X = X + K * (m - H * X)  |  P = (I - K * H) * P\n    this.X = add(X_p, mult(K, y));\n    this.P = mult(sub(identity(K.length), mult(K,this.H)), P_p);\n    return transpose(mult(this.H, this.X))[0]; //Transforms the predicted state back into it's measurement form\n};\n\n/**\n * Performs ridge regression, according to the Weka code.\n * @param {Array} y - corresponds to screen coordinates (either x or y) for each of n click events\n * @param {Array.<Array.<Number>>} X - corresponds to gray pixel features (120 pixels for both eyes) for each of n clicks\n * @param {Array} k - ridge parameter\n * @return{Array} regression coefficients\n */\nutil_regression.ridge = function(y, X, k){\n    var nc = X[0].length;\n    var m_Coefficients = new Array(nc);\n    var xt = mat.transpose(X);\n    var solution = new Array();\n    var success = true;\n    do{\n        var ss = mat.mult(xt,X);\n        // Set ridge regression adjustment\n        for (var i = 0; i < nc; i++) {\n            ss[i][i] = ss[i][i] + k;\n        }\n\n        // Carry out the regression\n        var bb = mat.mult(xt,y);\n        for(var i = 0; i < nc; i++) {\n            m_Coefficients[i] = bb[i][0];\n        }\n        try{\n            var n = (m_Coefficients.length !== 0 ? m_Coefficients.length/m_Coefficients.length: 0);\n            if (m_Coefficients.length*n !== m_Coefficients.length){\n                console.log('Array length must be a multiple of m')\n            }\n            solution = (ss.length === ss[0].length ? (numeric.LUsolve(numeric.LU(ss,true),bb)) : (webgazer.mat.QRDecomposition(ss,bb)));\n\n            for (var i = 0; i < nc; i++){\n                m_Coefficients[i] = solution[i];\n            }\n            success = true;\n        }\n        catch (ex){\n            k *= 10;\n            console.log(ex);\n            success = false;\n        }\n    } while (!success);\n    return m_Coefficients;\n}\n\n/**\n * Add given data to current data set then,\n * replace current data member with given data\n * @param {Array.<Object>} data - The data to set\n */\nutil_regression.setData = function(data) {\n  for (var i = 0; i < data.length; i++) {\n    // Clone data array\n    var leftData = new Uint8ClampedArray(data[i].eyes.left.patch.data);\n    var rightData = new Uint8ClampedArray(data[i].eyes.right.patch.data);\n    // Duplicate ImageData object\n    data[i].eyes.left.patch = new ImageData(leftData, data[i].eyes.left.width, data[i].eyes.left.height);\n    data[i].eyes.right.patch = new ImageData(rightData, data[i].eyes.right.width, data[i].eyes.right.height);\n\n    // Add those data objects to model\n    this.addData(data[i].eyes, data[i].screenPos, data[i].type);\n  }\n};\n\n\n//not used ?!\n//TODO: still usefull ???\n/**\n *\n * @returns {Number}\n */\nutil_regression.getCurrentFixationIndex = function() {\n  var index = 0;\n  var recentX = this.screenXTrailArray.get(0);\n  var recentY = this.screenYTrailArray.get(0);\n  for (var i = this.screenXTrailArray.length - 1; i >= 0; i--) {\n    var currX = this.screenXTrailArray.get(i);\n    var currY = this.screenYTrailArray.get(i);\n    var euclideanDistance = Math.sqrt(Math.pow((currX-recentX),2)+Math.pow((currY-recentY),2));\n    if (euclideanDistance > 72){\n      return i+1;\n    }\n  }\n  return i;\n}\n\nutil_regression.addData = function(eyes, screenPos, type) {\n    if (!eyes) {\n        return;\n    }\n    //not doing anything with blink at present\n    // if (eyes.left.blink || eyes.right.blink) {\n    //     return;\n    // }\n    if (type === 'click') {\n        this.screenXClicksArray.push([screenPos[0]]);\n        this.screenYClicksArray.push([screenPos[1]]);\n        this.eyeFeaturesClicks.push(util.getEyeFeats(eyes));\n        this.dataClicks.push({'eyes':eyes, 'screenPos':screenPos, 'type':type});\n    } else if (type === 'move') {\n        this.screenXTrailArray.push([screenPos[0]]);\n        this.screenYTrailArray.push([screenPos[1]]);\n\n        this.eyeFeaturesTrail.push(util.getEyeFeats(eyes));\n        this.trailTimes.push(performance.now());\n        this.dataTrail.push({'eyes':eyes, 'screenPos':screenPos, 'type':type});\n    }\n\n    // [20180730 JT] Why do we do this? It doesn't return anything...\n    // But as JS is pass by reference, it still affects it.\n    //\n    // Causes problems for when we want to call 'addData' twice in a row on the same object, but perhaps with different screenPos or types (think multiple interactions within one video frame)\n    //eyes.left.patch = Array.from(eyes.left.patch.data);\n    //eyes.right.patch = Array.from(eyes.right.patch.data);\n};\n\nexport default util_regression;","import util from './util';\nimport util_regression from './util_regression';\nimport params from './params';\n\nconst reg = {};\n\n/**\n * Constructor of RidgeReg object,\n * this object allow to perform ridge regression\n * @constructor\n */\nreg.RidgeReg = function() {\n  this.init();\n};\n\n/**\n * Initialize new arrays and initialize Kalman filter.\n */\nreg.RidgeReg.prototype.init = util_regression.InitRegression\n\n/**\n * Add given data from eyes\n * @param {Object} eyes - eyes where extract data to add\n * @param {Object} screenPos - The current screen point\n * @param {Object} type - The type of performed action\n */\nreg.RidgeReg.prototype.addData = util_regression.addData\n\n/**\n * Try to predict coordinates from pupil data\n * after apply linear regression on data set\n * @param {Object} eyesObj - The current user eyes object\n * @returns {Object}\n */\nreg.RidgeReg.prototype.predict = function(eyesObj) {\n  if (!eyesObj || this.eyeFeaturesClicks.length === 0) {\n    return null;\n  }\n  var acceptTime = performance.now() - this.trailTime;\n  var trailX = [];\n  var trailY = [];\n  var trailFeat = [];\n  for (var i = 0; i < this.trailDataWindow; i++) {\n    if (this.trailTimes.get(i) > acceptTime) {\n      trailX.push(this.screenXTrailArray.get(i));\n      trailY.push(this.screenYTrailArray.get(i));\n      trailFeat.push(this.eyeFeaturesTrail.get(i));\n    }\n  }\n\n  var screenXArray = this.screenXClicksArray.data.concat(trailX);\n  var screenYArray = this.screenYClicksArray.data.concat(trailY);\n  var eyeFeatures = this.eyeFeaturesClicks.data.concat(trailFeat);\n\n  var coefficientsX = util_regression.ridge(screenXArray, eyeFeatures, this.ridgeParameter);\n  var coefficientsY = util_regression.ridge(screenYArray, eyeFeatures, this.ridgeParameter);\n\n  var eyeFeats = util.getEyeFeats(eyesObj);\n  var predictedX = 0;\n  for(var i=0; i< eyeFeats.length; i++){\n    predictedX += eyeFeats[i] * coefficientsX[i];\n  }\n  var predictedY = 0;\n  for(var i=0; i< eyeFeats.length; i++){\n    predictedY += eyeFeats[i] * coefficientsY[i];\n  }\n\n  predictedX = Math.floor(predictedX);\n  predictedY = Math.floor(predictedY);\n\n  if (params.applyKalmanFilter) {\n    // Update Kalman model, and get prediction\n    var newGaze = [predictedX, predictedY]; // [20200607 xk] Should we use a 1x4 vector?\n    newGaze = this.kalman.update(newGaze);\n\n    return {\n      x: newGaze[0],\n      y: newGaze[1]\n    };\n  } else {\n    return {\n      x: predictedX,\n      y: predictedY\n    };\n  }\n};\n\nreg.RidgeReg.prototype.setData = util_regression.setData;\n\n/**\n * Return the data\n * @returns {Array.<Object>|*}\n */\nreg.RidgeReg.prototype.getData = function() {\n  return this.dataClicks.data;\n}\n\n/**\n * The RidgeReg object name\n * @type {string}\n */\nreg.RidgeReg.prototype.name = 'ridge';\n\nexport default reg;\n","import util from './util';\nimport util_regression from './util_regression';\nimport params from './params'\n\nconst reg = {};\n\n/**\n * Constructor of RidgeWeightedReg object\n * @constructor\n */\nreg.RidgeWeightedReg = function() {\n    this.init();\n};\n\n/**\n * Initialize new arrays and initialize Kalman filter.\n */\nreg.RidgeWeightedReg.prototype.init = util_regression.InitRegression\n\n/**\n * Add given data from eyes\n * @param {Object} eyes - eyes where extract data to add\n * @param {Object} screenPos - The current screen point\n * @param {Object} type - The type of performed action\n */\nreg.RidgeWeightedReg.prototype.addData = util_regression.addData\n\n/**\n * Try to predict coordinates from pupil data\n * after apply linear regression on data set\n * @param {Object} eyesObj - The current user eyes object\n * @returns {Object}\n */\nreg.RidgeWeightedReg.prototype.predict = function(eyesObj) {\n    if (!eyesObj || this.eyeFeaturesClicks.length === 0) {\n        return null;\n    }\n    var acceptTime = performance.now() - this.trailTime;\n    var trailX = [];\n    var trailY = [];\n    var trailFeat = [];\n    for (var i = 0; i < this.trailDataWindow; i++) {\n        if (this.trailTimes.get(i) > acceptTime) {\n            trailX.push(this.screenXTrailArray.get(i));\n            trailY.push(this.screenYTrailArray.get(i));\n            trailFeat.push(this.eyeFeaturesTrail.get(i));\n        }\n    }\n\n    var len = this.eyeFeaturesClicks.data.length;\n    var weightedEyeFeats = Array(len);\n    var weightedXArray = Array(len);\n    var weightedYArray = Array(len);\n    for (var i = 0; i < len; i++) {\n        var weight = Math.sqrt( 1 / (len - i) ); // access from oldest to newest so should start with low weight and increase steadily\n        //abstraction is leaking...\n        var trueIndex = this.eyeFeaturesClicks.getTrueIndex(i);\n        for (var j = 0; j < this.eyeFeaturesClicks.data[trueIndex].length; j++) {\n            var val = this.eyeFeaturesClicks.data[trueIndex][j] * weight;\n            if (weightedEyeFeats[trueIndex] !== undefined){\n                weightedEyeFeats[trueIndex].push(val);\n            } else {\n                weightedEyeFeats[trueIndex] = [val];\n            }\n        }\n        weightedXArray[trueIndex] = this.screenXClicksArray.get(i).slice(0, this.screenXClicksArray.get(i).length);\n        weightedYArray[trueIndex] = this.screenYClicksArray.get(i).slice(0, this.screenYClicksArray.get(i).length);\n        weightedXArray[i][0] = weightedXArray[i][0] * weight;\n        weightedYArray[i][0] = weightedYArray[i][0] * weight;\n    }\n\n    var screenXArray = weightedXArray.concat(trailX);\n    var screenYArray = weightedYArray.concat(trailY);\n    var eyeFeatures = weightedEyeFeats.concat(trailFeat);\n\n    var coefficientsX = util_regression.ridge(screenXArray, eyeFeatures, this.ridgeParameter);\n    var coefficientsY = util_regression.ridge(screenYArray, eyeFeatures, this.ridgeParameter);\n\n    var eyeFeats = util.getEyeFeats(eyesObj);\n    var predictedX = 0;\n    for(var i=0; i< eyeFeats.length; i++){\n        predictedX += eyeFeats[i] * coefficientsX[i];\n    }\n    var predictedY = 0;\n    for(var i=0; i< eyeFeats.length; i++){\n        predictedY += eyeFeats[i] * coefficientsY[i];\n    }\n\n    predictedX = Math.floor(predictedX);\n    predictedY = Math.floor(predictedY);\n\n    if (params.applyKalmanFilter) {\n        // Update Kalman model, and get prediction\n        var newGaze = [predictedX, predictedY]; // [20200607 xk] Should we use a 1x4 vector?\n        newGaze = this.kalman.update(newGaze);\n\n        return {\n            x: newGaze[0],\n            y: newGaze[1]\n        };\n    } else {\n        return {\n            x: predictedX,\n            y: predictedY\n        };\n    }\n};\n\nreg.RidgeWeightedReg.prototype.setData = util_regression.setData;\n\n/**\n * Return the data\n * @returns {Array.<Object>|*}\n */\nreg.RidgeWeightedReg.prototype.getData = function() {\n    return this.dataClicks.data;\n};\n\n/**\n * The RidgeWeightedReg object name\n * @type {string}\n */\nreg.RidgeWeightedReg.prototype.name = 'ridgeWeighted';\n\nexport default reg;\n","import util from './util';\nimport numeric from 'numeric';\nimport util_regression from './util_regression';\nimport params from './params';\n\nconst reg = {};\n\nvar ridgeParameter = Math.pow(10,-5);\nvar dataWindow = 700;\nvar weights = {'X':[0],'Y':[0]};\nvar trailDataWindow = 10;\n\n\n/**\n * Constructor of RidgeRegThreaded object,\n * it retrieve data window, and prepare a worker,\n * this object allow to perform threaded ridge regression\n * @constructor\n */\nreg.RidgeRegThreaded = function() {\n    this.init();\n};\n\n/**\n * Initialize new arrays and initialize Kalman filter.\n */\nreg.RidgeRegThreaded.prototype.init = function() { \n    this.screenXClicksArray = new util.DataWindow(dataWindow);  \n    this.screenYClicksArray = new util.DataWindow(dataWindow);  \n    this.eyeFeaturesClicks = new util.DataWindow(dataWindow);   \n\n    this.screenXTrailArray = new util.DataWindow(trailDataWindow);  \n    this.screenYTrailArray = new util.DataWindow(trailDataWindow);  \n    this.eyeFeaturesTrail = new util.DataWindow(trailDataWindow);   \n\n    this.dataClicks = new util.DataWindow(dataWindow);  \n    this.dataTrail = new util.DataWindow(dataWindow);   \n\n    // Place the src/ridgeworker.js file into the same directory as your html file. \n    if (!this.worker) { \n        this.worker = new Worker('ridgeWorker.mjs'); // [20200708] TODO: Figure out how to make this inline \n        this.worker.onerror = function(err) { console.log(err.message); };  \n        this.worker.onmessage = function(evt) { \n            weights.X = evt.data.X; \n            weights.Y = evt.data.Y; \n        };  \n        console.log('initialized worker');  \n    }   \n\n    // Initialize Kalman filter [20200608 xk] what do we do about parameters?   \n    // [20200611 xk] unsure what to do w.r.t. dimensionality of these matrices. So far at least \n    //               by my own anecdotal observation a 4x1 x vector seems to work alright   \n    var F = [ [1, 0, 1, 0], \n              [0, 1, 0, 1], \n              [0, 0, 1, 0], \n              [0, 0, 0, 1]];    \n\n    //Parameters Q and R may require some fine tuning   \n    var Q = [ [1/4, 0,    1/2, 0],  \n              [0,   1/4,  0,   1/2],    \n              [1/2, 0,    1,   0],  \n              [0,  1/2,  0,   1]];// * delta_t  \n    var delta_t = 1/10; // The amount of time between frames    \n    Q = numeric.mul(Q, delta_t);    \n\n    var H = [ [1, 0, 0, 0, 0, 0],   \n              [0, 1, 0, 0, 0, 0],   \n              [0, 0, 1, 0, 0, 0],   \n              [0, 0, 0, 1, 0, 0]];  \n    var H = [ [1, 0, 0, 0], \n              [0, 1, 0, 0]];    \n    var pixel_error = 47; //We will need to fine tune this value [20200611 xk] I just put a random value here   \n\n    //This matrix represents the expected measurement error \n    var R = numeric.mul(numeric.identity(2), pixel_error);  \n\n    var P_initial = numeric.mul(numeric.identity(4), 0.0001); //Initial covariance matrix   \n    var x_initial = [[500], [500], [0], [0]]; // Initial measurement matrix \n\n    this.kalman = new util_regression.KalmanFilter(F, H, Q, R, P_initial, x_initial);  \n}\n/**\n * Add given data from eyes\n * @param {Object} eyes - eyes where extract data to add\n * @param {Object} screenPos - The current screen point\n * @param {Object} type - The type of performed action\n */\nreg.RidgeRegThreaded.prototype.addData = function(eyes, screenPos, type) {\n    if (!eyes) {\n        return;\n    }\n    //not doing anything with blink at present\n    // if (eyes.left.blink || eyes.right.blink) {\n    //     return;\n    // }\n    this.worker.postMessage({'eyes':util.getEyeFeats(eyes), 'screenPos':screenPos, 'type':type});\n};\n\n/**\n * Try to predict coordinates from pupil data\n * after apply linear regression on data set\n * @param {Object} eyesObj - The current user eyes object\n * @returns {Object}\n */\nreg.RidgeRegThreaded.prototype.predict = function(eyesObj) {\n    // console.log('LOGGING..');\n    if (!eyesObj) {\n        return null;\n    }\n    var coefficientsX = weights.X;\n    var coefficientsY = weights.Y;\n\n    var eyeFeats = util.getEyeFeats(eyesObj);\n    var predictedX = 0, predictedY = 0;\n    for(var i=0; i< eyeFeats.length; i++){\n        predictedX += eyeFeats[i] * coefficientsX[i];\n        predictedY += eyeFeats[i] * coefficientsY[i];\n    }\n\n    predictedX = Math.floor(predictedX);\n    predictedY = Math.floor(predictedY);\n\n    if (params.applyKalmanFilter) {\n        // Update Kalman model, and get prediction\n        var newGaze = [predictedX, predictedY]; // [20200607 xk] Should we use a 1x4 vector?\n        newGaze = this.kalman.update(newGaze);\n\n        return {\n            x: newGaze[0],\n            y: newGaze[1]\n        };\n    } else {\n        return {\n            x: predictedX,\n            y: predictedY\n        };\n    }\n};\n\n/**\n * Add given data to current data set then,\n * replace current data member with given data\n * @param {Array.<Object>} data - The data to set\n */\nreg.RidgeRegThreaded.prototype.setData = util_regression.setData\n\n/**\n * Return the data\n * @returns {Array.<Object>|*}\n */\nreg.RidgeRegThreaded.prototype.getData = function() {\n    return this.dataClicks.data;\n};\n\n/**\n * The RidgeRegThreaded object name\n * @type {string}\n */\nreg.RidgeRegThreaded.prototype.name = 'ridge';\n\nexport default reg;\n","import '@tensorflow/tfjs';\n//import(/* webpackPreload: true */ '@tensorflow/tfjs');\n//import(/* webpackChunkName: 'pageA' */ './vendors~main.js')\n\nimport 'regression';\nimport params from './params';\nimport './dom_util';\nimport localforage from 'localforage';\nimport TFFaceMesh from './facemesh';\nimport Reg from './ridgeReg';\nimport ridgeRegWeighted from './ridgeWeightedReg';\nimport ridgeRegThreaded from './ridgeRegThreaded';\nimport util from './util';\n\nconst webgazer = {};\nwebgazer.tracker = {};\nwebgazer.tracker.TFFaceMesh = TFFaceMesh;\nwebgazer.reg = Reg;\nwebgazer.reg.RidgeWeightedReg = ridgeRegWeighted.RidgeWeightedReg;\nwebgazer.reg.RidgeRegThreaded = ridgeRegThreaded.RidgeRegThreaded;\nwebgazer.util = util;\nwebgazer.params = params;\n\n//PRIVATE VARIABLES\n\n//video elements\nvar videoStream = null;\nvar videoContainerElement = null;\nvar videoElement = null;\nvar videoElementCanvas = null;\nvar faceOverlay = null;\nvar faceFeedbackBox = null;\nvar gazeDot = null;\n// Why is this not in webgazer.params ?\nvar debugVideoLoc = '';\n\n/*\n * Initialises variables used to store accuracy eigenValues\n * This is used by the calibration example file\n */\nvar xPast50 = new Array(50);\nvar yPast50 = new Array(50);\n\n// loop parameters\nvar clockStart = performance.now();\nvar latestEyeFeatures = null;\nvar latestGazeData = null;\nvar paused = false;\n//registered callback for loop\nvar nopCallback = function(data, time) {};\nvar callback = nopCallback;\n\n//Types that regression systems should handle\n//Describes the source of data so that regression systems may ignore or handle differently the various generating events\nvar eventTypes = ['click', 'move'];\n\n//movelistener timeout clock parameters\nvar moveClock = performance.now();\n//currently used tracker and regression models, defaults to clmtrackr and linear regression\nvar curTracker = new webgazer.tracker.TFFaceMesh();\nvar regs = [new webgazer.reg.RidgeReg()];\n// var blinkDetector = new webgazer.BlinkDetector();\n\n//lookup tables\nvar curTrackerMap = {\n  'TFFacemesh': function() { return new webgazer.tracker.TFFaceMesh(); },\n};\nvar regressionMap = {\n  'ridge': function() { return new webgazer.reg.RidgeReg(); },\n  'weightedRidge': function() { return new webgazer.reg.RidgeWeightedReg(); },\n  'threadedRidge': function() { return new webgazer.reg.RidgeRegThreaded(); },\n};\n\n//localstorage name\nvar localstorageDataLabel = 'webgazerGlobalData';\nvar localstorageSettingsLabel = 'webgazerGlobalSettings';\n//settings object for future storage of settings\nvar settings = {};\nvar data = [];\nvar defaults = {\n  'data': [],\n  'settings': {}\n};\n\n\n//PRIVATE FUNCTIONS\n\n/**\n * Computes the size of the face overlay validation box depending on the size of the video preview window.\n * @returns {Object} The dimensions of the validation box as top, left, width, height.\n */\nwebgazer.computeValidationBoxSize = function() {\n\n  var vw = videoElement.videoWidth;\n  var vh = videoElement.videoHeight;\n  var pw = parseInt(videoElement.style.width);\n  var ph = parseInt(videoElement.style.height);\n\n  // Find the size of the box.\n  // Pick the smaller of the two video preview sizes\n  var smaller = Math.min( vw, vh );\n  var larger  = Math.max( vw, vh );\n\n  // Overall scalar\n  var scalar = ( vw == larger ? pw / vw : ph / vh );\n\n  // Multiply this by 2/3, then adjust it to the size of the preview\n  var boxSize = (smaller * webgazer.params.faceFeedbackBoxRatio) * scalar;\n\n  // Set the boundaries of the face overlay validation box based on the preview\n  var topVal = (ph - boxSize)/2;\n  var leftVal = (pw - boxSize)/2;\n\n  // top, left, width, height\n  return [topVal, leftVal, boxSize, boxSize]\n}\n\n/**\n * Checks if the pupils are in the position box on the video\n * // TODO These are all wrong. The latestEyeFeatures will be in 'video' space not 'preview' space, and so need to be converted.\n */\nfunction checkEyesInValidationBox() {\n\n  if (faceFeedbackBox != null && latestEyeFeatures) {\n    var w = videoElement.videoWidth;\n    var h = videoElement.videoHeight;\n\n    // Find the size of the box.\n    // Pick the smaller of the two video preview sizes\n    var smaller = Math.min( w, h );\n    var boxSize = smaller * webgazer.params.faceFeedbackBoxRatio;\n\n    // Set the boundaries of the face overlay validation box based on the preview\n    var topBound = (h - boxSize)/2;\n    var leftBound = (w - boxSize)/2;\n    var rightBound = leftBound + boxSize;\n    var bottomBound = topBound + boxSize;\n\n    //get the x and y positions of the left and right eyes\n    var eyeLX = latestEyeFeatures.left.imagex;\n    var eyeLY = latestEyeFeatures.left.imagey;\n    var eyeRX = latestEyeFeatures.right.imagex;\n    var eyeRY = latestEyeFeatures.right.imagey;\n\n\n    var xPositions = false;\n    var yPositions = false;\n\n    //check if the x values for the left and right eye are within the\n    //validation box\n    if (eyeLX > leftBound && eyeLX < rightBound) {\n      if (eyeRX > leftBound && eyeRX < rightBound) {\n        xPositions = true;\n      }\n    }\n\n    //check if the y values for the left and right eye are within the\n    //validation box\n    if (eyeLY > topBound && eyeLY < bottomBound) {\n      if (eyeRY > topBound && eyeRY < bottomBound) {\n        yPositions = true;\n      }\n    }\n\n    //if the x and y values for both the left and right eye are within\n    //the validation box then the box border turns green, otherwise if\n    //the eyes are outside of the box the colour is red\n    if (xPositions && yPositions){\n      faceFeedbackBox.style.border = 'solid green';\n    } else {\n      faceFeedbackBox.style.border = 'solid red';\n    }\n  }\n  else\n    faceFeedbackBox.style.border = 'solid black';\n}\n\n/**\n * This draws the point (x,y) onto the canvas in the HTML\n * @param {colour} colour - The colour of the circle to plot\n * @param {x} x - The x co-ordinate of the desired point to plot\n * @param {y} y - The y co-ordinate of the desired point to plot\n */\nfunction drawCoordinates(colour,x,y){\n  var ctx = document.getElementById(\"plotting_canvas\").getContext('2d');\n  ctx.fillStyle = colour; // Red color\n  ctx.beginPath();\n  ctx.arc(x, y, 5, 0, Math.PI * 2, true);\n  ctx.fill();\n}\n\n/**\n * Gets the pupil features by following the pipeline which threads an eyes object through each call:\n * curTracker gets eye patches -> blink detector -> pupil detection\n * @param {Canvas} canvas - a canvas which will have the video drawn onto it\n * @param {Number} width - the width of canvas\n * @param {Number} height - the height of canvas\n */\nfunction getPupilFeatures(canvas, width, height) {\n  if (!canvas) {\n    return;\n  }\n  try {\n    return curTracker.getEyePatches(canvas, width, height);\n  } catch(err) {\n    console.log(\"can't get pupil features \", err);\n    return null;\n  }\n}\n\n/**\n * Gets the most current frame of video and paints it to a resized version of the canvas with width and height\n * @param {Canvas} canvas - the canvas to paint the video on to\n * @param {Number} width - the new width of the canvas\n * @param {Number} height - the new height of the canvas\n */\nfunction paintCurrentFrame(canvas, width, height) {\n  if (canvas.width != width) {\n    canvas.width = width;\n  }\n  if (canvas.height != height) {\n    canvas.height = height;\n  }\n\n  var ctx = canvas.getContext('2d');\n  ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);\n}\n\n/**\n * Paints the video to a canvas and runs the prediction pipeline to get a prediction\n * @param {Number|undefined} regModelIndex - The prediction index we're looking for\n * @returns {*}\n */\nasync function getPrediction(regModelIndex) {\n  var predictions = [];\n  // [20200617 xk] TODO: this call should be made async somehow. will take some work.\n  latestEyeFeatures = await getPupilFeatures(videoElementCanvas, videoElementCanvas.width, videoElementCanvas.height);\n\n  if (regs.length === 0) {\n    console.log('regression not set, call setRegression()');\n    return null;\n  }\n  for (var reg in regs) {\n    predictions.push(regs[reg].predict(latestEyeFeatures));\n  }\n  if (regModelIndex !== undefined) {\n    return predictions[regModelIndex] === null ? null : {\n      'x' : predictions[regModelIndex].x,\n      'y' : predictions[regModelIndex].y,\n      'eyeFeatures': latestEyeFeatures\n    };\n  } else {\n    return predictions.length === 0 || predictions[0] === null ? null : {\n      'x' : predictions[0].x,\n      'y' : predictions[0].y,\n      'eyeFeatures': latestEyeFeatures,\n      'all' : predictions\n    };\n  }\n}\n\n/**\n * Runs every available animation frame if webgazer is not paused\n */\nvar smoothingVals = new util.DataWindow(4);\nvar k = 0;\n\nasync function loop() {\n  if (!paused) {\n\n    // [20200617 XK] TODO: there is currently lag between the camera input and the face overlay. This behavior\n    // is not seen in the facemesh demo. probably need to optimize async implementation. I think the issue lies\n    // in the implementation of getPrediction().\n\n    // Paint the latest video frame into the canvas which will be analyzed by WebGazer\n    // [20180729 JT] Why do we need to do this? clmTracker does this itself _already_, which is just duplicating the work.\n    // Is it because other trackers need a canvas instead of an img/video element?\n    paintCurrentFrame(videoElementCanvas, videoElementCanvas.width, videoElementCanvas.height);\n\n    // Get gaze prediction (ask clm to track; pass the data to the regressor; get back a prediction)\n    latestGazeData = getPrediction();\n    // Count time\n    var elapsedTime = performance.now() - clockStart;\n\n\n    // Draw face overlay\n    if( webgazer.params.showFaceOverlay )\n    {\n      // Get tracker object\n      var tracker = webgazer.getTracker();\n      faceOverlay.getContext('2d').clearRect( 0, 0, videoElement.videoWidth, videoElement.videoHeight);\n      tracker.drawFaceOverlay(faceOverlay.getContext('2d'), tracker.getPositions());\n    }\n\n    // Feedback box\n    // Check that the eyes are inside of the validation box\n    if( webgazer.params.showFaceFeedbackBox )\n      checkEyesInValidationBox();\n\n    latestGazeData = await latestGazeData;\n\n    // [20200623 xk] callback to function passed into setGazeListener(fn)\n    callback(latestGazeData, elapsedTime);\n\n    if( latestGazeData ) {\n      // [20200608 XK] Smoothing across the most recent 4 predictions, do we need this with Kalman filter?\n      smoothingVals.push(latestGazeData);\n      var x = 0;\n      var y = 0;\n      var len = smoothingVals.length;\n      for (var d in smoothingVals.data) {\n        x += smoothingVals.get(d).x;\n        y += smoothingVals.get(d).y;\n      }\n\n      var pred = util.bound({'x':x/len, 'y':y/len});\n\n      if (webgazer.params.storingPoints) {\n        drawCoordinates('blue',pred.x,pred.y); //draws the previous predictions\n        //store the position of the past fifty occuring tracker preditions\n        webgazer.storePoints(pred.x, pred.y, k);\n        k++;\n        if (k == 50) {\n          k = 0;\n        }\n      }\n      // GazeDot\n      if (webgazer.params.showGazeDot) {\n        gazeDot.style.display = 'block';\n      }\n      gazeDot.style.transform = 'translate3d(' + pred.x + 'px,' + pred.y + 'px,0)';\n    } else {\n      gazeDot.style.display = 'none';\n    }\n\n    requestAnimationFrame(loop);\n  }\n}\n\n//is problematic to test\n//because latestEyeFeatures is not set in many cases\n\n/**\n * Records screen position data based on current pupil feature and passes it\n * to the regression model.\n * @param {Number} x - The x screen position\n * @param {Number} y - The y screen position\n * @param {String} eventType - The event type to store\n * @returns {null}\n */\nvar recordScreenPosition = function(x, y, eventType) {\n  if (paused) {\n    return;\n  }\n  if (regs.length === 0) {\n    console.log('regression not set, call setRegression()');\n    return null;\n  }\n  for (var reg in regs) {\n    if( latestEyeFeatures )\n      regs[reg].addData(latestEyeFeatures, [x, y], eventType);\n  }\n};\n\n/**\n * Records click data and passes it to the regression model\n * @param {Event} event - The listened event\n */\nvar clickListener = async function(event) {\n  recordScreenPosition(event.clientX, event.clientY, eventTypes[0]); // eventType[0] === 'click'\n\n  if (webgazer.params.saveDataAcrossSessions) {\n    // Each click stores the next data point into localforage.\n    await setGlobalData();\n\n    // // Debug line\n    // console.log('Model size: ' + JSON.stringify(await localforage.getItem(localstorageDataLabel)).length / 1000000 + 'MB');\n  }\n};\n\n/**\n * Records mouse movement data and passes it to the regression model\n * @param {Event} event - The listened event\n */\nvar moveListener = function(event) {\n  if (paused) {\n    return;\n  }\n\n  var now = performance.now();\n  if (now < moveClock + webgazer.params.moveTickSize) {\n    return;\n  } else {\n    moveClock = now;\n  }\n  recordScreenPosition(event.clientX, event.clientY, eventTypes[1]); //eventType[1] === 'move'\n};\n\n/**\n * Add event listeners for mouse click and move.\n */\nvar addMouseEventListeners = function() {\n  //third argument set to true so that we get event on 'capture' instead of 'bubbling'\n  //this prevents a client using event.stopPropagation() preventing our access to the click\n  document.addEventListener('click', clickListener, true);\n  document.addEventListener('mousemove', moveListener, true);\n};\n\n/**\n * Remove event listeners for mouse click and move.\n */\nvar removeMouseEventListeners = function() {\n  // must set third argument to same value used in addMouseEventListeners\n  // for this to work.\n  document.removeEventListener('click', clickListener, true);\n  document.removeEventListener('mousemove', moveListener, true);\n};\n\n/**\n * Loads the global data and passes it to the regression model\n */\nasync function loadGlobalData() {\n  // Get settings object from localforage\n  // [20200611 xk] still unsure what this does, maybe would be good for Kalman filter settings etc?\n  settings = await localforage.getItem(localstorageSettingsLabel);\n  settings = settings || defaults;\n\n  // Get click data from localforage\n  var loadData = await localforage.getItem(localstorageDataLabel);\n  loadData = loadData || defaults;\n\n  // Set global var data to newly loaded data\n  data = loadData;\n\n  // Load data into regression model(s)\n  for (var reg in regs) {\n    regs[reg].setData(loadData);\n  }\n\n  console.log(\"loaded stored data into regression model\");\n}\n\n/**\n * Adds data to localforage\n */\nasync function setGlobalData() {\n  // Grab data from regression model\n  var storeData = regs[0].getData() || data; // Array\n\n  // Store data into localforage\n  localforage.setItem(localstorageSettingsLabel, settings) // [20200605 XK] is 'settings' ever being used?\n  localforage.setItem(localstorageDataLabel, storeData);\n  //TODO data should probably be stored in webgazer object instead of each regression model\n  //     -> requires duplication of data, but is likely easier on regression model implementors\n}\n\n/**\n * Clears data from model and global storage\n */\nfunction clearData() {\n  // Removes data from localforage\n  localforage.clear();\n\n  // Removes data from regression model\n  for (var reg in regs) {\n    regs[reg].init();\n  }\n}\n\n/**\n * Initializes all needed dom elements and begins the loop\n * @param {URL} stream - The video stream to use\n */\nasync function init(stream) {\n  //////////////////////////\n  // Video and video preview\n  //////////////////////////\n  var topDist = '0px'\n  var leftDist = '0px'\n\n  // used for webgazer.stopVideo() and webgazer.setCameraConstraints()\n  videoStream = stream;\n\n  // create a video element container to enable customizable placement on the page\n  videoContainerElement = document.createElement('div');\n  videoContainerElement.id = webgazer.params.videoContainerId;\n  videoContainerElement.style.display = webgazer.params.showVideo ? 'block' : 'none';\n  videoContainerElement.style.position = 'fixed';\n  videoContainerElement.style.top = topDist;\n  videoContainerElement.style.left = leftDist;\n  videoContainerElement.style.width = webgazer.params.videoViewerWidth + 'px';\n  videoContainerElement.style.height = webgazer.params.videoViewerHeight + 'px';\n  \n  videoElement = document.createElement('video');\n  videoElement.setAttribute('playsinline', '');\n  videoElement.id = webgazer.params.videoElementId;\n  videoElement.srcObject = stream;\n  videoElement.autoplay = true;\n  videoElement.style.display = webgazer.params.showVideo ? 'block' : 'none';\n  videoElement.style.position = 'absolute';\n  // We set these to stop the video appearing too large when it is added for the very first time\n  videoElement.style.width = webgazer.params.videoViewerWidth + 'px';\n  videoElement.style.height = webgazer.params.videoViewerHeight + 'px';\n  // videoElement.style.zIndex=\"-1\";\n\n  // Canvas for drawing video to pass to clm tracker\n  videoElementCanvas = document.createElement('canvas');\n  videoElementCanvas.id = webgazer.params.videoElementCanvasId;\n  videoElementCanvas.style.display = 'none';\n\n  // Face overlay\n  // Shows the CLM tracking result\n  faceOverlay = document.createElement('canvas');\n  faceOverlay.id = webgazer.params.faceOverlayId;\n  faceOverlay.style.display = webgazer.params.showFaceOverlay ? 'block' : 'none';\n  faceOverlay.style.position = 'absolute';\n\n  // Mirror video feed\n  if (webgazer.params.mirrorVideo) {\n    videoElement.style.setProperty(\"-moz-transform\", \"scale(-1, 1)\");\n    videoElement.style.setProperty(\"-webkit-transform\", \"scale(-1, 1)\");\n    videoElement.style.setProperty(\"-o-transform\", \"scale(-1, 1)\");\n    videoElement.style.setProperty(\"transform\", \"scale(-1, 1)\");\n    videoElement.style.setProperty(\"filter\", \"FlipH\");\n    faceOverlay.style.setProperty(\"-moz-transform\", \"scale(-1, 1)\");\n    faceOverlay.style.setProperty(\"-webkit-transform\", \"scale(-1, 1)\");\n    faceOverlay.style.setProperty(\"-o-transform\", \"scale(-1, 1)\");\n    faceOverlay.style.setProperty(\"transform\", \"scale(-1, 1)\");\n    faceOverlay.style.setProperty(\"filter\", \"FlipH\");\n  }\n\n  // Feedback box\n  // Lets the user know when their face is in the middle\n  faceFeedbackBox = document.createElement('canvas');\n  faceFeedbackBox.id = webgazer.params.faceFeedbackBoxId;\n  faceFeedbackBox.style.display = webgazer.params.showFaceFeedbackBox ? 'block' : 'none';\n  faceFeedbackBox.style.border = 'solid';\n  faceFeedbackBox.style.position = 'absolute';\n\n  // Gaze dot\n  // Starts offscreen\n  gazeDot = document.createElement('div');\n  gazeDot.id = webgazer.params.gazeDotId;\n  gazeDot.style.display = webgazer.params.showGazeDot ? 'block' : 'none';\n  gazeDot.style.position = 'fixed';\n  gazeDot.style.zIndex = 99999;\n  gazeDot.style.left = '-5px'; //'-999em';\n  gazeDot.style.top  = '-5px';\n  gazeDot.style.background = 'red';\n  gazeDot.style.borderRadius = '100%';\n  gazeDot.style.opacity = '0.7';\n  gazeDot.style.width = '10px';\n  gazeDot.style.height = '10px';\n\n  // Add other preview/feedback elements to the screen once the video has shown and its parameters are initialized\n  videoContainerElement.appendChild(videoElement);\n  document.body.appendChild(videoContainerElement);\n  function setupPreviewVideo(e) {\n\n    // All video preview parts have now been added, so set the size both internally and in the preview window.\n    setInternalVideoBufferSizes( videoElement.videoWidth, videoElement.videoHeight );\n    webgazer.setVideoViewerSize( webgazer.params.videoViewerWidth, webgazer.params.videoViewerHeight );\n\n    videoContainerElement.appendChild(videoElementCanvas);\n    videoContainerElement.appendChild(faceOverlay);\n    videoContainerElement.appendChild(faceFeedbackBox);\n    document.body.appendChild(gazeDot);\n\n    // Run this only once, so remove the event listener\n    e.target.removeEventListener(e.type, setupPreviewVideo);\n  };\n  videoElement.addEventListener('timeupdate', setupPreviewVideo);\n\n  addMouseEventListeners();\n\n  //BEGIN CALLBACK LOOP\n  paused = false;\n  clockStart = performance.now();\n\n  await loop();\n}\n\n/**\n * Initializes navigator.mediaDevices.getUserMedia\n * depending on the browser capabilities\n * \n * @return Promise \n */\nfunction setUserMediaVariable(){\n\n  if (navigator.mediaDevices === undefined) {\n    navigator.mediaDevices = {};\n  }\n\n  if (navigator.mediaDevices.getUserMedia === undefined) {\n    navigator.mediaDevices.getUserMedia = function(constraints) {\n\n      // gets the alternative old getUserMedia is possible\n      var getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;\n\n      // set an error message if browser doesn't support getUserMedia\n      if (!getUserMedia) {\n        return Promise.reject(new Error(\"Unfortunately, your browser does not support access to the webcam through the getUserMedia API. Try to use the latest version of Google Chrome, Mozilla Firefox, Opera, or Microsoft Edge instead.\"));\n      }\n\n      // uses navigator.getUserMedia for older browsers\n      return new Promise(function(resolve, reject) {\n        getUserMedia.call(navigator, constraints, resolve, reject);\n      });\n    }\n  }\n}\n\n//PUBLIC FUNCTIONS - CONTROL\n\n/**\n * Starts all state related to webgazer -> dataLoop, video collection, click listener\n * If starting fails, call `onFail` param function.\n * @param {Function} onFail - Callback to call in case it is impossible to find user camera\n * @returns {*}\n */\nwebgazer.begin = function(onFail) {\n  if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost' && window.chrome){\n    alert(\"WebGazer works only over https. If you are doing local development, you need to run a local server.\");\n  }\n\n  // Load model data stored in localforage.\n  if (webgazer.params.saveDataAcrossSessions) {\n    loadGlobalData();\n  }\n\n  onFail = onFail || function() {console.log('No stream')};\n\n  if (debugVideoLoc) {\n    init(debugVideoLoc);\n    return webgazer;\n  }\n\n  ///////////////////////\n  // SETUP VIDEO ELEMENTS\n  // Sets .mediaDevices.getUserMedia depending on browser\n  setUserMediaVariable();\n\n  // Request webcam access under specific constraints\n  // WAIT for access\n  return new Promise(async (resolve, reject) => {\n    let stream;\n    try {\n      stream = await navigator.mediaDevices.getUserMedia( webgazer.params.camConstraints );\n      init(stream);\n      resolve(webgazer);\n    } catch(err) {\n      onFail();\n      videoElement = null;\n      stream = null;\n      reject(err);\n    }\n  });\n};\n\n\n/**\n * Checks if webgazer has finished initializing after calling begin()\n * [20180729 JT] This seems like a bad idea for how this function should be implemented.\n * @returns {boolean} if webgazer is ready\n */\nwebgazer.isReady = function() {\n  if (videoElementCanvas === null) {\n    return false;\n  }\n  return videoElementCanvas.width > 0;\n};\n\n/**\n * Stops collection of data and predictions\n * @returns {webgazer} this\n */\nwebgazer.pause = function() {\n  paused = true;\n  return webgazer;\n};\n\n/**\n * Resumes collection of data and predictions if paused\n * @returns {webgazer} this\n */\nwebgazer.resume = async function() {\n  if (!paused) {\n    return webgazer;\n  }\n  paused = false;\n  await loop();\n  return webgazer;\n};\n\n/**\n * stops collection of data and removes dom modifications, must call begin() to reset up\n * @return {webgazer} this\n */\nwebgazer.end = function() {\n  //loop may run an extra time and fail due to removed elements\n  paused = true;\n\n  //webgazer.stopVideo(); // uncomment if you want to stop the video from streaming\n\n  //remove video element and canvas\n  document.body.removeChild(videoElement);\n  document.body.removeChild(videoElementCanvas);\n\n  return webgazer;\n};\n\n/**\n * Stops the video camera from streaming and removes the video outlines\n * @return {webgazer} this\n */\nwebgazer.stopVideo = function() {\n  // Stops the video from streaming\n  videoStream.getTracks()[0].stop();\n\n  // Removes the outline of the face\n  document.body.removeChild( faceOverlay );\n\n  // Removes the box around the face\n  document.body.removeChild( faceFeedbackBox );\n\n  return webgazer;\n}\n\n\n//PUBLIC FUNCTIONS - DEBUG\n\n/**\n * Returns if the browser is compatible with webgazer\n * @return {boolean} if browser is compatible\n */\nwebgazer.detectCompatibility = function() {\n\n  var getUserMedia = navigator.mediaDevices.getUserMedia ||\n    navigator.getUserMedia ||\n    navigator.webkitGetUserMedia ||\n    navigator.mozGetUserMedia;\n\n  return getUserMedia !== undefined;\n};\n\n/**\n * Set whether to show any of the video previews (camera, face overlay, feedback box).\n * If true: visibility depends on corresponding params (default all true).\n * If false: camera, face overlay, feedback box are all hidden\n * @param {bool} val\n * @return {webgazer} this\n */\nwebgazer.showVideoPreview = function(val) {\n  webgazer.params.showVideoPreview = val;\n  webgazer.showVideo(val && webgazer.params.showVideo);\n  webgazer.showFaceOverlay(val && webgazer.params.showFaceOverlay);\n  webgazer.showFaceFeedbackBox(val && webgazer.params.showFaceFeedbackBox);\n  return webgazer;\n}\n\n/**\n * Set whether the camera video preview is visible or not (default true).\n * @param {*} bool\n * @return {webgazer} this\n */\nwebgazer.showVideo = function(val) {\n  webgazer.params.showVideo = val;\n  if(videoElement) {\n    videoElement.style.display = val ? 'block' : 'none';\n  }\n  if(videoContainerElement) {\n    videoContainerElement.style.display = val ? 'block' : 'none';\n  }\n  return webgazer;\n};\n\n/**\n * Set whether the face overlay is visible or not (default true).\n * @param {*} bool\n * @return {webgazer} this\n */\nwebgazer.showFaceOverlay = function(val) {\n  webgazer.params.showFaceOverlay = val;\n  if( faceOverlay ) {\n    faceOverlay.style.display = val ? 'block' : 'none';\n  }\n  return webgazer;\n};\n\n/**\n * Set whether the face feedback box is visible or not (default true).\n * @param {*} bool\n * @return {webgazer} this\n */\nwebgazer.showFaceFeedbackBox = function(val) {\n\n  webgazer.params.showFaceFeedbackBox = val;\n  if( faceFeedbackBox ) {\n    faceFeedbackBox.style.display = val ? 'block' : 'none';\n  }\n  return webgazer;\n};\n\n/**\n * Set whether the gaze prediction point(s) are visible or not.\n * Multiple because of a trail of past dots. Default true\n * @return {webgazer} this\n */\nwebgazer.showPredictionPoints = function(val) {\n  webgazer.params.showGazeDot = val;\n  if( gazeDot ) {\n    gazeDot.style.display = val ? 'block' : 'none';\n  }\n  return webgazer;\n};\n\n/**\n * Set whether localprevious calibration data (from localforage) should be loaded.\n * Default true.\n * \n * NOTE: Should be called before webgazer.begin() -- see www/js/main.js for example\n * \n * @param val \n * @returns {webgazer} this\n */\nwebgazer.saveDataAcrossSessions = function(val) {\n  webgazer.params.saveDataAcrossSessions = val;\n  return webgazer;\n}\n\n/**\n * Set whether a Kalman filter will be applied to gaze predictions (default true);\n * @return {webgazer} this\n */\nwebgazer.applyKalmanFilter = function(val) {\n  webgazer.params.applyKalmanFilter = val;\n  return webgazer;\n}\n\n/**\n * Define constraints on the video camera that is used. Useful for non-standard setups.\n * This can be set before calling webgazer.begin(), but also mid stream.\n *\n * @param {Object} constraints Example constraints object:\n * { width: { min: 320, ideal: 1280, max: 1920 }, height: { min: 240, ideal: 720, max: 1080 }, facingMode: \"user\" };\n *\n * Follows definition here:\n * https://developer.mozilla.org/en-US/docs/Web/API/Media_Streams_API/Constraints\n *\n * Note: The constraints set here are applied to the video track only. They also _replace_ any constraints, so be sure to set everything you need.\n * Warning: Setting a large video resolution will decrease performance, and may require\n */\nwebgazer.setCameraConstraints = async function(constraints) {\n  var videoTrack,videoSettings;\n  webgazer.params.camConstraints = constraints;\n\n  // If the camera stream is already up...\n  if(videoStream)\n  {\n    webgazer.pause();\n    videoTrack = videoStream.getVideoTracks()[0];\n    try {\n      await videoTrack.applyConstraints( webgazer.params.camConstraints );\n      videoSettings = videoTrack.getSettings();\n      setInternalVideoBufferSizes( videoSettings.width, videoSettings.height );\n    } catch(err) {\n      console.log( err );\n      return;\n    }\n    // Reset and recompute sizes of the video viewer.\n    // This is only to adjust the feedback box, say, if the aspect ratio of the video has changed.\n    webgazer.setVideoViewerSize( webgazer.params.videoViewerWidth, webgazer.params.videoViewerHeight )\n    webgazer.getTracker().reset();\n    await webgazer.resume();\n  }\n}\n\n\n/**\n * Does what it says on the tin.\n * @param {*} width\n * @param {*} height\n */\nfunction setInternalVideoBufferSizes( width, height ) {\n  // Re-set the canvas size used by the internal processes\n  if( videoElementCanvas )\n  {\n    videoElementCanvas.width = width;\n    videoElementCanvas.height = height;\n  }\n\n  // Re-set the face overlay canvas size\n  if( faceOverlay )\n  {\n    faceOverlay.width = width;\n    faceOverlay.height = height;\n  }\n}\n\n/**\n *  Set a static video file to be used instead of webcam video\n *  @param {String} videoLoc - video file location\n *  @return {webgazer} this\n */\nwebgazer.setStaticVideo = function(videoLoc) {\n  debugVideoLoc = videoLoc;\n  return webgazer;\n};\n\n/**\n * Set the size of the video viewer\n */\nwebgazer.setVideoViewerSize = function(w, h) {\n\n  webgazer.params.videoViewerWidth = w;\n  webgazer.params.videoViewerHeight = h;\n\n  // Change the video viewer\n  videoElement.style.width = w + 'px';\n  videoElement.style.height = h + 'px';\n\n  // Change the face overlay\n  faceOverlay.style.width = w + 'px';\n  faceOverlay.style.height = h + 'px';\n\n  // Change the feedback box size\n  // Compute the boundaries of the face overlay validation box based on the video size\n  var tlwh = webgazer.computeValidationBoxSize()\n  // Assign them to the object\n  faceFeedbackBox.style.top = tlwh[0] + 'px';\n  faceFeedbackBox.style.left = tlwh[1] + 'px';\n  faceFeedbackBox.style.width = tlwh[2] + 'px';\n  faceFeedbackBox.style.height = tlwh[3] + 'px';\n};\n\n/**\n *  Add the mouse click and move listeners that add training data.\n *  @return {webgazer} this\n */\nwebgazer.addMouseEventListeners = function() {\n  addMouseEventListeners();\n  return webgazer;\n};\n\n/**\n *  Remove the mouse click and move listeners that add training data.\n *  @return {webgazer} this\n */\nwebgazer.removeMouseEventListeners = function() {\n  removeMouseEventListeners();\n  return webgazer;\n};\n\n/**\n *  Records current screen position for current pupil features.\n *  @param {String} x - position on screen in the x axis\n *  @param {String} y - position on screen in the y axis\n *  @return {webgazer} this\n */\nwebgazer.recordScreenPosition = function(x, y) {\n  // give this the same weight that a click gets.\n  recordScreenPosition(x, y, eventTypes[0]);\n  return webgazer;\n};\n\n/**\n *  Records current screen position for current pupil features.\n *  @param {String} x - position on screen in the x axis\n *  @param {String} y - position on screen in the y axis\n *  @param {String} eventType - \"click\" or \"move\", as per eventTypes\n *  @return {webgazer} this\n */\nwebgazer.recordScreenPosition = function(x, y, eventType) {\n  // give this the same weight that a click gets.\n  recordScreenPosition(x, y, eventType);\n  return webgazer;\n};\n\n/*\n * Stores the position of the fifty most recent tracker preditions\n */\nwebgazer.storePoints = function(x, y, k) {\n  xPast50[k] = x;\n  yPast50[k] = y;\n}\n\n//SETTERS\n/**\n * Sets the tracking module\n * @param {String} name - The name of the tracking module to use\n * @return {webgazer} this\n */\nwebgazer.setTracker = function(name) {\n  if (curTrackerMap[name] === undefined) {\n    console.log('Invalid tracker selection');\n    console.log('Options are: ');\n    for (var t in curTrackerMap) {\n      console.log(t);\n    }\n    return webgazer;\n  }\n  curTracker = curTrackerMap[name]();\n  return webgazer;\n};\n\n/**\n * Sets the regression module and clears any other regression modules\n * @param {String} name - The name of the regression module to use\n * @return {webgazer} this\n */\nwebgazer.setRegression = function(name) {\n  if (regressionMap[name] === undefined) {\n    console.log('Invalid regression selection');\n    console.log('Options are: ');\n    for (var reg in regressionMap) {\n      console.log(reg);\n    }\n    return webgazer;\n  }\n  data = regs[0].getData();\n  regs = [regressionMap[name]()];\n  regs[0].setData(data);\n  return webgazer;\n};\n\n/**\n * Adds a new tracker module so that it can be used by setTracker()\n * @param {String} name - the new name of the tracker\n * @param {Function} constructor - the constructor of the curTracker object\n * @return {webgazer} this\n */\nwebgazer.addTrackerModule = function(name, constructor) {\n  curTrackerMap[name] = function() {\n    return new constructor();\n  };\n};\n\n/**\n * Adds a new regression module so that it can be used by setRegression() and addRegression()\n * @param {String} name - the new name of the regression\n * @param {Function} constructor - the constructor of the regression object\n */\nwebgazer.addRegressionModule = function(name, constructor) {\n  regressionMap[name] = function() {\n    return new constructor();\n  };\n};\n\n/**\n * Adds a new regression module to the list of regression modules, seeding its data from the first regression module\n * @param {String} name - the string name of the regression module to add\n * @return {webgazer} this\n */\nwebgazer.addRegression = function(name) {\n  var newReg = regressionMap[name]();\n  data = regs[0].getData();\n  newReg.setData(data);\n  regs.push(newReg);\n  return webgazer;\n};\n\n/**\n * Sets a callback to be executed on every gaze event (currently all time steps)\n * @param {function} listener - The callback function to call (it must be like function(data, elapsedTime))\n * @return {webgazer} this\n */\nwebgazer.setGazeListener = function(listener) {\n  callback = listener;\n  return webgazer;\n};\n\n/**\n * Removes the callback set by setGazeListener\n * @return {webgazer} this\n */\nwebgazer.clearGazeListener = function() {\n  callback = nopCallback;\n  return webgazer;\n};\n\n/**\n * Set the video element canvas; useful if you want to run WebGazer on your own canvas (e.g., on any random image).\n * @return The current video element canvas\n */\nwebgazer.setVideoElementCanvas = function(canvas) {\n  videoElementCanvas = canvas;\n}\n\n/**\n * Clear data from localforage and from regs\n */\nwebgazer.clearData = async function() {\n  clearData();\n}\n\n\n//GETTERS\n/**\n * Returns the tracker currently in use\n * @return {tracker} an object following the tracker interface\n */\nwebgazer.getTracker = function() {\n  return curTracker;\n};\n\n/**\n * Returns the regression currently in use\n * @return {Array.<Object>} an array of regression objects following the regression interface\n */\nwebgazer.getRegression = function() {\n  return regs;\n};\n\n/**\n * Requests an immediate prediction\n * @return {object} prediction data object\n */\nwebgazer.getCurrentPrediction = function(regIndex) {\n  return getPrediction(regIndex);\n};\n\n/**\n * returns the different event types that may be passed to regressions when calling regression.addData()\n * @return {Array} array of strings where each string is an event type\n */\nwebgazer.params.getEventTypes = function() {\n  return eventTypes.slice();\n}\n\n/**\n * Get the video element canvas that WebGazer uses internally on which to run its face tracker.\n * @return The current video element canvas\n */\nwebgazer.getVideoElementCanvas = function() {\n  return videoElementCanvas;\n}\n\n/**\n * @return array [a,b] where a is width ratio and b is height ratio\n */\nwebgazer.getVideoPreviewToCameraResolutionRatio = function() {\n  return [webgazer.params.videoViewerWidth / videoElement.videoWidth, webgazer.params.videoViewerHeight / videoElement.videoHeight];\n}\n\n/*\n * Gets the fifty most recent tracker preditions\n */\nwebgazer.getStoredPoints = function() {\n  return [xPast50, yPast50];\n}\n\nexport default webgazer;\n"],"sourceRoot":""}